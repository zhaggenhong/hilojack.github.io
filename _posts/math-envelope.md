---
layout: page
title:	红包飞的概率问题
category: blog
description:
---
# Preface

100元的红包，分给10个人，每个人得的数额是随机的。请设计一个公平的算法，保证每个人得到的金额从数学期望上是相等的。


# 生成红包时就拆分好

## 此时生成10个随机数作权重
按每个随机数据的比例拆分

## 此时生成9个随机数,再排列，以间距拆分红包
生成9个随机数rand(0,100), 然后加一个100，并从小到大排序：s1,s2,...,s9,100. 第一个人得到的金额是s1, 第二个人得到的金额是s2-s1,..., 最后一个人得到的金额是100-s9. 加入的100 不是随机数，这样公平吗？

当然公平！让我们证明一下：假如随机数rand(0,1)

- 1个独立随机数中的最大值小于x 的概率是x^1, 相当于对 dx 求积分，上限x, 下限是0
- 2个独立随机数中的最大值小于x 的概率是x^2, 相当于对 (2*x)dx 求积分，上限x, 下限是0
- ...
- n个独立随机数中的最大值小于x 的概率是x^n, 相当于对 (n*x^(n-1))dx 求积分，上限x, 下限是0

那么n个独立随机数的最大值等于x 的概率是：(n*x^(n-1))dx.
概率乘以x 得(n*x^n)dx 积分上限1，下限0，得到的最大值期望就是：n/(n+1).
9 次随机数的期望就是 9/10. 最后一个获取的金额的期望就是(1/10). 就是公平的

如何计算最小值的期望？

2个独立随机数的最小值大于x 的概率是 `(1-x)^2`, 相当于对 `(2-2x)dx` 积分，上限1，下限x

那么最小值为x的概率就是 `(2-2x)*dx`, 对`(2-2x)*xdx` 积分,得到:`x^2-2/3*x^3`,上限1，下限0，得到 1/3
对`n*(1-x)^(n-1)*xdx` 积分,上限1，下限0，得到n/(n+1)

# 发送红包时拆分好

	total 每次抢的剩余金额为
	num	剩余人数
	min	最小金额(不限制最小金额时，min = 0)
	max	最大金额(不限制最大金额时，max >=total)

	//max = total 时
	if(num == 1)
		return total;
	t = total - min*mum;				/t 是可分得最大金额(除去了min)
	ram = min + t*rand(0,1) * (2/num);	/**期望 E(t*rand*2/num) = t * 0.5 * 2/num = t /num */
	return ram;

max 为给定值的情况下, 可以使用方式2：

	if(num == 1)
		return total;
	t = total - min*mum;				/t 是可分得最大金额(除去了min)
	tm = min(max-min, t);				//tm 是人为强制的最大金额: if max >= total, then tm = t

	人均期望与tm 期望之比为：
		ave/(tm/2) = (t/num) /(tm/2) = 2/num * (t/tm)

	ram = min + tm*rand(0,1) * (2/num) * (t/tm) = min + t*rand(0,1) * (2/num)
	return ram;

其实方法2 是错误的，它并没有限制max, 从结果上看这种计算同上面的方法本质上是一样的)：
在max 指定值的情况下，如何寻找一个概率分布（T分布？正态分布？F分布）的方法，使得值的范围是(min, max), 期望为(total/num)呢？
换句话说，值的范围是(0,max-min) 期望为(total/num - min)

