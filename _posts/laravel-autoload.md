---
layout: page
title:
category: blog
description:
---
# Preface
Based on composer

# vender/autoload.php
generated by composer:

	vender/composer/autoload_real.php - classLoader.php
		include_path.php
		autoload_namespaces.php psr0
		autoload_psr4.php
            'Illuminate\\' => array($vendorDir . '/laravel/framework/src/Illuminate'),
            'App\\' => array($baseDir . '/app'),
		autoload_classmap.php class->path
		autoload_files.php

# class alias

	config/app.php
		'Route'     => 'Illuminate\Support\Facades\Route',
		'View'      => 'Illuminate\Support\Facades\View',

import alias:

	vendor/laravel/framework/src/Illuminate/Foundation/Bootstrap/RegisterFacades.php:20
			AliasLoader::getInstance($app['config']['app.aliases'])->register();

get alias:

	[internal function]: Illuminate\Foundation\AliasLoader->load('Route')
	app/Http/routes.php(16): spl_autoload_call('Route')

# Config
config/*.php

	//load alias
	vendor/laravel/framework/src/Illuminate/Foundation/Bootstrap/LoadConfiguration.php:76
		Illuminate\Config\Repository->set('app', $v)

# Application
LoadConfiguration 在哪里加载？

vendor/laravel/framework/src/Illuminate/Foundation/Application.php:163 ->bootstrapWith()

	array(7) {
	  [0]=>
	  string(49) "Illuminate\Foundation\Bootstrap\DetectEnvironment"
	  [1]=>
	  string(49) "Illuminate\Foundation\Bootstrap\LoadConfiguration" (loadAlias)
	  [2]=>
	  string(48) "Illuminate\Foundation\Bootstrap\ConfigureLogging"
	  [3]=>
	  string(48) "Illuminate\Foundation\Bootstrap\HandleExceptions"
	  [4]=>
	  string(47) "Illuminate\Foundation\Bootstrap\RegisterFacades"	(importAlias)
	  [5]=>
	  string(49) "Illuminate\Foundation\Bootstrap\RegisterProviders"
	  [6]=>
	  string(45) "Illuminate\Foundation\Bootstrap\BootProviders"
	}


# facade
用于包装对象为静态类，比如Router 包装成Route::

	vendor/laravel/framework/src/Illuminate/Routing/Router.php(126):
		Illuminate\Routing\Router->addRoute(Array, '/2', 'Home2Controller...')
	vendor/laravel/framework/src/Illuminate/Support/Facades/Facade.php(213):
		Illuminate\Routing\Router->get('/2', 'Home2Controller...')
	app/Http/routes.php(18):
		Illuminate\Support\Facades\Facade::__callStatic('get', Array)
			$app['router'] 哪来来的
	app/Http/routes.php(18):
		Illuminate\Support\Facades\Route::get('/2', 'Home2Controller...')
	app/Providers/RouteServiceProvider.php(40):
		require('/Users/hilojack...')

$app['router'] 哪里实例化的? 基实并没有实例化！

	$app->registerBaseServiceProvider():
		(new RoutingServiceProvider($app))->registerRouter():
			$this->app['router'] = $this->app->share(function($app) {
				return new Router($app['events'], $app);
			});

app->share 继承$container->share():

	public function share(Closure $closure) {
		return function($container) use ($closure) {
			static $object;

			if (is_null($object)) {
				$object = $closure($container);
			}

			return $object;
		};
	}

registerBaseServiceProvider 来自Application:

	public function __construct($basePath = null) {
		$this->registerBaseBindings();

		$this->registerBaseServiceProviders();

		$this->registerCoreContainerAliases();

		if ($basePath) $this->setBasePath($basePath);
	}

